Project Overview
================

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Install

``` sh
pip install LTBP
```

## LTBP Use Cases

### Where results of LTR lives:

**Current Fiscal Season Results:** Development Results:
MachineLearningOutPuts.DEV.LTBP_PREDICTIONS

> Note: Development results will be something that we move around as
> more scale begins to happen, but that isnâ€™t solved as of now.

Development Results: MachineLearningOutPuts.LTBP.LTBP_PREDICTIONS

``` python
from LTBP.data.utils import snowflake_query

sf = snowflake_query()

display(sf.run_sql_str("SELECT COUNT(1) AS TOTAL_POP FROM MachineLearningOutPuts.LTBP.LTBP_PREDICTIONS"))

display(sf.run_sql_str("SELECT TOP 10 * FROM MachineLearningOutPuts.LTBP.LTBP_PREDICTIONS"))
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TOTAL_POP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14759852</td>
    </tr>
  </tbody>
</table>
</div>

    /Users/jeremydemlow/miniforge3/envs/ltbp/lib/python3.9/site-packages/data_system_utilities/snowflake/query.py:73: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
      df = pd.read_sql_query(query, connection)

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ECID</th>
      <th>PROBABILITY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>61068721</td>
      <td>0.038751</td>
    </tr>
    <tr>
      <th>1</th>
      <td>130053505</td>
      <td>0.492399</td>
    </tr>
    <tr>
      <th>2</th>
      <td>49940527</td>
      <td>0.051959</td>
    </tr>
    <tr>
      <th>3</th>
      <td>74112965</td>
      <td>0.034402</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32759861</td>
      <td>0.004805</td>
    </tr>
    <tr>
      <th>5</th>
      <td>57941408</td>
      <td>0.002742</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13674145</td>
      <td>0.065647</td>
    </tr>
    <tr>
      <th>7</th>
      <td>60909761</td>
      <td>0.009027</td>
    </tr>
    <tr>
      <th>8</th>
      <td>97172783</td>
      <td>0.002126</td>
    </tr>
    <tr>
      <th>9</th>
      <td>131977740</td>
      <td>0.109056</td>
    </tr>
  </tbody>
</table>
</div>

The output of LTBP_PREDICTIONS Table

**Schema:**

| Variable Name | Description                                                                  |
|:--------------|:-----------------------------------------------------------------------------|
| ECID          | Customer Key                                                                 |
| PROBABILITY   | The estimated probability that this ECID will buy a Pass in this Fiscal Year |

**Label Logic:**

LTBP is composed of five bins low, low-med, medium, med-high high. In
the past, there was an attempt to optimize the return rate to be heavy
in low, but for simplicity and scalability of this project, DSDE decided
to use NTILE, which creates equal buckets for the five labeled groups.

``` python
display(sf.run_sql_str("""
SELECT 
LikelihoodToBuyPassLabel,
COUNT(1) as Total
FROM (
SELECT ECID
, PROBABILITY
, ntile(5) over (ORDER BY PROBABILITY) as ntile_5
, CASE WHEN ntile_5 = 5 THEN 'High'
  WHEN ntile_5 = 4 THEN 'Med-High'
  WHEN ntile_5 = 3 THEN 'Medium'
  WHEN ntile_5 = 2 THEN 'Low-Med'
  WHEN ntile_5 = 1 THEN 'Low'
  END AS LikelihoodToBuyPassLabel
FROM MACHINELEARNINGOUTPUTS.ltbp.ltbp_PREDICTIONS ltbp
ORDER BY PROBABILITY DESC
)
GROUP BY LikelihoodToBuyPassLabel
"""))
```

    /Users/jeremydemlow/miniforge3/envs/ltbp/lib/python3.9/site-packages/data_system_utilities/snowflake/query.py:73: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
      df = pd.read_sql_query(query, connection)

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LIKELIHOODTOBUYPASSLABEL</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>High</td>
      <td>2951970</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Medium</td>
      <td>2951970</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Med-High</td>
      <td>2951970</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Low-Med</td>
      <td>2951971</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Low</td>
      <td>2951971</td>
    </tr>
  </tbody>
</table>
</div>

``` python
display(sf.run_sql_str("""SELECT ECID
, PROBABILITY
, ntile(5) over (ORDER BY PROBABILITY) as ntile_5
, CASE WHEN ntile_5 = 5 THEN 'High'
  WHEN ntile_5 = 4 THEN 'Med-High'
  WHEN ntile_5 = 3 THEN 'Medium'
  WHEN ntile_5 = 2 THEN 'Low-Med'
  WHEN ntile_5 = 1 THEN 'Low'
  END AS LikelihoodToBuyPassLabel
FROM MACHINELEARNINGOUTPUTS.ltbp.ltbp_PREDICTIONS ltbp
ORDER BY PROBABILITY DESC
LIMIT 10
"""))
```

    /Users/jeremydemlow/miniforge3/envs/ltbp/lib/python3.9/site-packages/data_system_utilities/snowflake/query.py:73: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
      df = pd.read_sql_query(query, connection)

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ECID</th>
      <th>PROBABILITY</th>
      <th>NTILE_5</th>
      <th>LIKELIHOODTOBUYPASSLABEL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>131035762</td>
      <td>0.999566</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>1</th>
      <td>112628819</td>
      <td>0.999552</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>2</th>
      <td>138473097</td>
      <td>0.999544</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>3</th>
      <td>102515974</td>
      <td>0.999541</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>4</th>
      <td>136960602</td>
      <td>0.999527</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>5</th>
      <td>131977201</td>
      <td>0.999525</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>6</th>
      <td>137118754</td>
      <td>0.999525</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>7</th>
      <td>137071085</td>
      <td>0.999522</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>8</th>
      <td>131795763</td>
      <td>0.999518</td>
      <td>5</td>
      <td>High</td>
    </tr>
    <tr>
      <th>9</th>
      <td>58857511</td>
      <td>0.999517</td>
      <td>5</td>
      <td>High</td>
    </tr>
  </tbody>
</table>
</div>
